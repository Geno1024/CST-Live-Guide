\section{定点数与浮点数}\label{sec:NumberSystemBasics/fixed-point-and-floating-point}
    解决了整数的记录问题之后，我们需要考虑小数的记录的问题。

    \subsection{定点数}\label{subsec:NumberSystemBasics/fixed-point-and-floating-point/fixed-point}

        我们可以参考之前学到的方式，直接记录小数的二进制。由于二进制中可用的数码 $0$ 和 $1$ 已经被全部用于表达数，因此已经没有记号用于在数码间标记小数点位置并且不造成歧义，所以需要人为预先规定小数点的位置。假设左起第一位为符号位，然后假设把小数点定在 $n$ 位与 $n + 1$ 位之间，剩下的为小数部分的话，那么可以表达的数的范围为 $(-\underbrace{11 \cdots 11}_{n-1}.\underbrace{11 \cdots 11}_{k-n})_2$ -- $(-0.\underbrace{00 \cdots 00}_{k-n}1)_2$ 和 $(0.\underbrace{00 \cdots 00}_{k-n}1)_2$ -- $(\underbrace{11 \cdots 11}_{n-1}.\underbrace{11 \cdots 11}_{k-n})_2$，分度值为 $(0.\underbrace{00 \cdots 00}_{k-n}1)_2$，或者转为十进制是 $-\frac{2^{(k-1)}-1}{2^{(k-n)}}$ -- $-\frac{1}{2^{(k-n)}}$ 和 $\frac{1}{2^{(k-n)}}$ -- $\frac{2^{(k-1)}-1}{2^{(k-n)}}$，分度值为 $\frac{1}{2^{(k-n)}}$。

        一个具体的例子如~\ref{fig:NumberSystemBasics/fixed-point-and-floating-point/fixed-point/data-range} 所示。

        % https://tex.stackexchange.com/a/130008/149813
        \begin{figure}
            \centering
            \begin{tabular}{lS[table-format=-3.7]S[table-format=-3.7]S[table-format=-3.7]}
                $n$ & 最小值     & 最大值    & 分度值    \\ \hline
                1   & -0.9921875 & 0.9921875  & 0.0078125 \\
                2   & -1.984375  & 1.984375   & 0.015625  \\
                3   & -3.96875   & 3.96875    & 0.03125   \\
                4   & -7.9375    & 7.9375     & 0.0625    \\
                5   & -15.875    & 15.875     & 0.125     \\
                6   & -31.75     & 31.75      & 0.25      \\
                7   & -63.5      & 63.5       & 0.5       \\
                8   & -127       & 127        & 1         \\
            \end{tabular}
            \caption{$k = 8$ 时 $n$ 的值对应的数据范围}
            \label{fig:NumberSystemBasics/fixed-point-and-floating-point/fixed-point/data-range}
        \end{figure}

        这种记录小数的方式，其小数点的位置是固定的，因此被称为定点数（Fixed Point）。比如说，对于二进制小数 $(101.01)_2$ 来说，在不损耗精度的前提下，不管如何修改上面的定义中的参数（即 $k$ 与 $n$），记录的小数点总是会在第二个 $1$ 和 $0$ 之间，这个小数点相对于这个数的位置是固定不变的，这就是“定点数”名称的来源。

        然而，这种记录方式有一个问题，就是无法在精度和范围中间达到平衡：如果采用更小的 $n$，那么可以提高精度，但是可以表达的数的范围便急剧减小；而如果试图提高范围，那么就得采用更大的 $n$，此时精度便开始降低。这个我们没有让“数码在数字中的位置”这个信息灵活起来。如果我们将存储所使用的权重在对数数轴上标记的话，那么会是如图~\ref{fig:NumberSystemBasics/fixed-point-and-floating-point/fixed-point/position} 所示的情况：

        \begin{figure}
            \centering
            \begin{tikzpicture}
                \draw [step = 0.5] (0, 0) grid (10, 0.5);
                \node at (5.25, 0.1) {.};

                \draw (1.5, -0.2) -- (1.5, -0.4) -- (3, -0.4);
                \draw (5.5, -0.2) -- (5.5, -0.4) -- (3.5, -0.4);
                \node at (3.25, -0.4) {8};

                \draw (2, -0.2) -- (2, -0.8) -- (3.5, -0.8);
                \draw (6, -0.2) -- (6, -0.8) -- (4, -0.8);
                \node at (3.75, -0.8) {7};

                \draw (2.5, -0.2) -- (2.5, -1.2) -- (4, -1.2);
                \draw (6.5, -0.2) -- (6.5, -1.2) -- (4.5, -1.2);
                \node at (4.25, -1.2) {6};

                \draw (3, -0.2) -- (3, -1.6) -- (4.5, -1.6);
                \draw (7, -0.2) -- (7, -1.6) -- (5, -1.6);
                \node at (4.75, -1.6) {5};

                \draw (3.5, 0.7) -- (3.5, 0.9) -- (5, 0.9);
                \draw (7.5, 0.7) -- (7.5, 0.9) -- (5.5, 0.9);
                \node at (5.25, 0.9) {4};

                \draw (4, 0.7) -- (4, 1.3) -- (5.5, 1.3);
                \draw (8, 0.7) -- (8, 1.3) -- (6, 1.3);
                \node at (5.75, 1.3) {3};

                \draw (4.5, 0.7) -- (4.5, 1.7) -- (6, 1.7);
                \draw (8.5, 0.7) -- (8.5, 1.7) -- (6.5, 1.7);
                \node at (6.25, 1.7) {2};

                \draw (5, 0.7) -- (5, 2.1) -- (6.5, 2.1);
                \draw (9, 0.7) -- (9, 2.1) -- (7, 2.1);
                \node at (6.75, 2.1) {1};
            \end{tikzpicture}
            \caption{存储位在数轴上的位置}
            \label{fig:NumberSystemBasics/fixed-point-and-floating-point/fixed-point/position}
        \end{figure}

    \subsection{浮点数}\label{subsec:NumberSystemBasics/fixed-point-and-floating-point/floating-point}
        在平时，当我们遇到一个比较大或者比较小的数的时候，我们通常使用科学记数法（Scientific Notation）来简化记录。例如，数 $16000$ 可以用科学记数法记为
        \[1.6 \times 10^4\]
        ，其中 $\times$ 号前面的数记录了原本的数字，称为尾数（Mantissa），$\times$ 号后面的部分是一个乘方的形式，乘方的底数事实上指示了原数的进制，称为基（Base），指数（Exponent）指示了位置，保留名称。

        在记录小数时，为了取得精度和范围的平衡，我们可以借鉴科学记数法，使用一定的存储位表达位置，用余下的存储位来存储数值。诚然，在有限的存储位中再抠出一部分用于存储位置会损失精度，但是我们换来了更大的数值范围，而且对于大一点的数字而言，只要我们充分地权衡好这个损失的量，那么损失少量的精度是可以接受的。

        这种记录数字的方式，所记录的数字的小数点的位置，是可以变化的。例如 $16000$ 既可以表示为 $1.6 \times 10^4$，也可以表示为 $16 \times 10^3$，甚至可以表示为 $0.0016 \times 10^7$ 等，这些不同的表示方式均表示同一个数，而其小数点位置则可以浮动，由此得名“浮点数”。

        由于基是固定的（对于现代常见的二进制计算机，基为 $2$），因此我们只需要记录尾数和指数，即可表示一个浮点数。

        在这些由于小数点位置变化而出现的不同的浮点数表示法中，我们将一个尾数部分在 $1$（含）和 $10$（不含）之间的表示形式指定为规格化（Normalized）\footnote{另有“规范化”、“规约化”、“规则化”、“正规化”等翻译。}数，其他的则称之为非规格化（Denormalized）数。

    \subsection{浮点数的几种记录方式}\label{subsec:NumberSystemBasics/fixed-point-and-floating-point/floating-point-notations}
        在\sout{漫漫的}计算机历史长河中，曾经出现过大量的浮点数记录方式。在被标准化之前，这些浮点数记录方式可以被大致分为三类\cite{jjgsavard-2005-cp0201}：

        % TODO: 补充 IEEE 754 之前的历史
    \subsection{IEEE 754}\label{subsec:NumberSystemBasics/fixed-point-and-floating-point/ieee-754}
        1985 年 3 月 21 日，电气电子工程师学会（IEEE）通过了《二进制浮点数算术的 IEEE 标准》\footnote{IEEE 754--1985 IEEE Standard for Binary Floating-Point Arithmetic\cite{ieee754-1985}}（IEEE 754）。该标准成为了浮点数表示的业界规范。

        \subsubsection{前置定义}\label{subsubsec:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/predef}
            IEEE 754 标准首先定义了描述一个浮点数规范的几个参数：
            \begin{itemize}
                \item $p$ 是有效位数的数量，即精度；
                \item $E_{\max}$ 是最大的指数值；
                \item $E_{\min}$ 是最小的指数值。
            \end{itemize}

            接着定义了一个浮点数的表示方式所需要包含的定义：
            \begin{itemize}
                \item 形如 $(-1)^s2^E(b_0 \cdot b_1b_2 \cdots b_{p-1})$\footnote{“$b_0 \cdot b_1$”中的“$\cdot$”是小数点，而非乘号。这里表示的是数字直接写在一起的连接，类似于数学上的 $\overline{b_1b_2 \cdots b_n}$，而非连乘法。下同。} 的数，其中
                    \begin{itemize}
                        \item $s$ 是 $0$ 或者 $1$；
                        \item $E$ 是 $E_{\max}$（含）和 $E_{\min}$（含）之间的正整数；
                        \item $b_i$ 是 $0$ 或者 $1$；
                    \end{itemize}
                \item 两个无穷大，$+\infty$ 和 $-\infty$；
                \item 至少一个会触发异常信号（Signaling）的 NaN\footnote{Not a Number 的简写。}；
                \item 至少一个不会触发异常信号（Quiet）的 NaN。
            \end{itemize}

            一个单精度或双精度二进制浮点数格式包含以下三部分：
            \begin{itemize}
                \item 1 位符号位 $s$；
                \item 偏移指数（Biased exponent）$e$，等于 $E$ 加上偏移；
                \item 分数（Fraction，其实也就是上文所述的“尾数”）$f$，等于 $\cdot b_1b_2 \cdots b_{p-1}$。
            \end{itemize}

        \subsubsection{基础格式}\label{subsubsec:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/basic-format}
            IEEE 754 在如上的基础上，定义了两种浮点数：单精度（Single）浮点数和双精度（Double）浮点数。

            单精度浮点数由 32 位二进制数组成，从左到右分别是 1 位的符号位 $s$，8 位的偏移指数 $e$ 和 23 位的分数 $f$，如图~\ref{fig:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/basic-format/single} 所示，
            \begin{figure}
                \centering
                \begin{tikzpicture}
                    \draw (0, 0) rectangle (0.25, 0.25);
                    \node at (0.125, 0.125) {s};
                    \node at (0.125, -0.25) {1};

                    \draw (0.25, 0) rectangle (2.25, 0.25);
                    \node at (1.25, 0.125) {e};
                    \node at (1.25, -0.25) {8};

                    \draw (2.25, 0) rectangle (8, 0.25);
                    \node at (5.125, 0.125) {f};
                    \node at (5.125, -0.25) {23};
                \end{tikzpicture}
                \caption{IEEE 754 单精度浮点数示意图}
                \label{fig:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/basic-format/single}
            \end{figure}

            并定义：
            \begin{enumerate}
                \item 如果 $e$ 是 $255$ 且 $f$ 不为 $0$（形如 $s\ 11111111\ bbbb \cdots bbbb$），那么其表示的值为 NaN；
                \item 如果 $e$ 是 $255$ 且 $f$ 为 $0$（形如 $s\ 11111111\ 0000 \cdots 0000$），那么其表示的值为 $(-1)^s\infty$；
                \item 如果 $e$ 在 $0$（不含）和 $255$（不含）之间（通常情况），那么其表示的值为 $(-1)^s2^{e-127}(1 \cdot f)$；
                \item 如果 $e$ 为 $0$ 但 $f$ 不为 $0$（形如 $s\ 00000000\ bbbb \cdots bbbb$），那么其表示的值为非规格化浮点数 $(-1)^s2^{-126}(0 \cdot f)$；
                \item 如果 $e$ 和 $f$ 均为 $0$（形如 $s\ 000000000\ 0000 \cdots 0000$），那么其表示的值为 $(-1)^s0$。
            \end{enumerate}

            双精度浮点数由 64 位二进制数组成，从左到右分别是 1 位的符号位 $s$，11 位的偏移指数 $e$ 和 52 位的分数 $f$，如图~\ref{fig:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/basic-format/double} 所示，
            \begin{figure}
                \centering
                \begin{tikzpicture}
                    \draw (0, 0) rectangle (0.25, 0.25);
                    \node at (0.125, 0.125) {s};
                    \node at (0.125, -0.25) {1};

                    \draw (0.25, 0) rectangle (3, 0.25);
                    \node at (1.625, 0.125) {e};
                    \node at (1.625, -0.25) {11};

                    \draw (3, 0) rectangle (16, 0.25);
                    \node at (9.5, 0.125) {f};
                    \node at (9.5, -0.25) {52};
                \end{tikzpicture}
                \caption{IEEE 754 双精度浮点数示意图}
                \label{fig:NumberSystemBasics/fixed-point-and-floating-point/ieee-754/basic-format/double}
            \end{figure}

            并定义：
            \begin{enumerate}
                \item 如果 $e$ 是 $2047$ 且 $f$ 不为 $0$（形如 $s\ 11111111111\ bbbb \cdots bbbb$），那么其表示的值为 NaN；
                \item 如果 $e$ 是 $2047$ 且 $f$ 为 $0$（形如 $s\ 11111111111\ 0000 \cdots 0000$），那么其表示的值为 $(-1)^s\infty$；
                \item 如果 $e$ 在 $0$（不含）和 $2047$（不含）之间（通常情况），那么其表示的值为 $(-1)^s2^{e-1023}(1 \cdot f)$；
                \item 如果 $e$ 为 $0$ 但 $f$ 不为 $0$（形如 $s\ 00000000000\ bbbb \cdots bbbb$），那么其表示的值为非规格化浮点数 $(-1)^s2^{-1022}(0 \cdot f)$；
                \item 如果 $e$ 和 $f$ 均为 $0$（形如 $s\ 00000000000\ 0000 \cdots 0000$），那么其表示的值为 $(-1)^s0$。
            \end{enumerate}
